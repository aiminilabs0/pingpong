<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Pingpong Rubber Chart</title>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chartjs-plugin-datalabels@2.0.0"></script>
    <style>
        body {
            font-family: Arial, sans-serif;
            display: flex;
            justify-content: center;
            align-items: center;
            height: 100vh;
            margin: 0;
            background-color: #f0f0f0;
        }
        .chart-container {
            position: relative;
            height: 80vh;
            width: 80vw;
            background-color: #e5e5e5;
            border-radius: 8px;
            padding: 20px;
            box-shadow: 0 4px 6px rgba(0,0,0,0.1);
            display: flex;
            flex-direction: column;
            gap: 12px;
            overflow: hidden;
        }
        .tabs {
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 10px;
        }
        .tab {
            appearance: none;
            border: 1px solid rgba(0,0,0,0.18);
            background: rgba(255,255,255,0.55);
            color: #111;
            border-radius: 999px;
            padding: 8px 12px;
            display: inline-flex;
            align-items: center;
            gap: 8px;
            cursor: pointer;
            font-size: 13px;
            font-weight: 600;
            user-select: none;
            transition: background-color 140ms ease, border-color 140ms ease, box-shadow 140ms ease;
        }
        .tab:hover {
            background: rgba(255,255,255,0.8);
            border-color: rgba(0,0,0,0.25);
        }
        .tab:focus-visible {
            outline: none;
            box-shadow: 0 0 0 3px rgba(30, 144, 255, 0.35);
        }
        .tab.active {
            background: rgba(255,255,255,0.95);
            border-color: rgba(0,0,0,0.35);
        }
        .tab img {
            width: 18px;
            height: 18px;
            object-fit: contain;
        }
        .canvas-wrap {
            position: relative;
            flex: 1;
        }
    </style>
</head>
<body>

<div class="chart-container">
    <div class="tabs" role="tablist" aria-label="Brand">
        <button class="tab active" type="button" role="tab" aria-selected="true" data-brand="Butterfly">
            <img src="images/butterfly.ico" alt="" aria-hidden="true" />
            Butterfly
        </button>
        <button class="tab" type="button" role="tab" aria-selected="false" data-brand="Tibhar">
            <img src="images/tibhar.png" alt="" aria-hidden="true" />
            Tibhar
        </button>
    </div>
    <div class="canvas-wrap">
        <canvas id="rubberChart"></canvas>
    </div>
</div>

<script>
    // --- 1. Consolidated Data ---
    // We store color and shape directly with the data point to keep the visual distinction
    // while using only one dataset.

    // Brand-specific knobs (easy to replace later)
    const BUTTERFLY = 'Butterfly';
    const BUTTERFLY_COLOR = '#e84191';
    const BUTTERFLY_ICON = 'images/butterfly.ico';

    const TIBHAR = 'Tibhar';
    const TIBHAR_COLOR = '#d32f2f';
    const TIBHAR_ICON = 'images/tibhar.png';

    // Axis ranges per brand (used by the tabs).
    // Tune these numbers if you want a tighter/looser zoom per brand.
    const BRAND_AXIS_RANGES = {
        [BUTTERFLY]: { xMin: 50,  xMax: 110, yMin: 50,  yMax: 100 },
        [TIBHAR]:    { xMin: 110, xMax: 135, yMin: 110, yMax: 135 },
    };
    
    // Each rubber can optionally include a `url` for manual product links:
    // { x, y, label, color, shape, url: 'https://...' }
    const butterflyRubbers = [
        // Orange Squares (Tenergy)
        { x: 75, y: 84, label: 'Tenergy 19',      color: BUTTERFLY_COLOR, shape: 'rect' },
        { x: 70, y: 87, label: 'Tenergy 64',      color: BUTTERFLY_COLOR, shape: 'rect' },
        { x: 58, y: 85, label: 'Tenergy 64 FX',   color: BUTTERFLY_COLOR, shape: 'rect' },
        { x: 73, y: 85, label: 'Tenergy 80',      color: BUTTERFLY_COLOR, shape: 'rect' },
        { x: 61, y: 83, label: 'Tenergy 80 FX',   color: BUTTERFLY_COLOR, shape: 'rect' },
        { x: 76, y: 83, label: 'Tenergy 05',      color: BUTTERFLY_COLOR, shape: 'rect' },
        { x: 64, y: 81, label: 'Tenergy 05 FX',   color: BUTTERFLY_COLOR, shape: 'rect' },
        { x: 96, y: 82, label: 'Tenergy 05 Hard', color: BUTTERFLY_COLOR, shape: 'rect' },
        { x: 76, y: 64, label: 'Tenergy 25',      color: BUTTERFLY_COLOR, shape: 'rect' },
        { x: 64, y: 62, label: 'Tenergy 25 FX',   color: BUTTERFLY_COLOR, shape: 'rect' },
        { x: 70, y: 83, label: 'Rozena',          color: BUTTERFLY_COLOR, shape: 'rect' },
        { x: 79, y: 90, label: 'Dignics 64',      color: BUTTERFLY_COLOR, shape: 'rect' },
        { x: 82, y: 88, label: 'Dignics 80',      color: BUTTERFLY_COLOR, shape: 'rect' },
        { x: 85, y: 86, label: 'Dignics 05',      color: BUTTERFLY_COLOR, shape: 'rect' },
        { x: 96, y: 79, label: 'Dignics 09C',     color: BUTTERFLY_COLOR, shape: 'circle' },
        { x: 73, y: 81, label: 'Glayzer',         color: BUTTERFLY_COLOR, shape: 'rect' },
        { x: 87, y: 75, label: 'Glayzer 09C',     color: BUTTERFLY_COLOR, shape: 'circle' },
        { x: 100, y: 88, label: 'Zyre 03',        color: BUTTERFLY_COLOR, shape: 'rect' },
    ];

    // Add Tibhar rubbers here (same format as Butterfly).
    // Example:
    const tibharRubbers = [
        // NOTE: input format provided as "Speed (y) then Spin (x)"
        { x: 120, y: 124, label: 'EL-D',      color: TIBHAR_COLOR, shape: 'rect',   url: '' },
        { x: 117, y: 121, label: 'EL-P',      color: TIBHAR_COLOR, shape: 'rect',   url: '' },
        { x: 120, y: 123, label: 'EL-S',      color: TIBHAR_COLOR, shape: 'rect',   url: '' },
        { x: 118, y: 120, label: 'FX-D',      color: TIBHAR_COLOR, shape: 'rect',   url: '' },
        { x: 115, y: 120, label: 'FX-P',      color: TIBHAR_COLOR, shape: 'rect',   url: '' },
        { x: 117, y: 118, label: 'FX-S',      color: TIBHAR_COLOR, shape: 'rect',   url: '' },
        { x: 122, y: 130, label: 'MX-D',      color: TIBHAR_COLOR, shape: 'rect',   url: '' },
        { x: 122, y: 125, label: 'MX-P',      color: TIBHAR_COLOR, shape: 'rect',   url: '' },
        { x: 120, y: 128, label: 'MX-P 50',   color: TIBHAR_COLOR, shape: 'rect',   url: '' },
        { x: 124, y: 125, label: 'MX-S',      color: TIBHAR_COLOR, shape: 'rect',   url: '' },
        { x: 130, y: 118, label: 'K3',        color: TIBHAR_COLOR, shape: 'circle', url: '' },
        { x: 130, y: 115, label: 'K3 FX',     color: TIBHAR_COLOR, shape: 'circle', url: '' },
        { x: 130, y: 125, label: 'K3 Pro',    color: TIBHAR_COLOR, shape: 'circle', url: '' },
        { x: 120, y: 124, label: 'MK',        color: TIBHAR_COLOR, shape: 'circle', url: '' },
        { x: 118, y: 118, label: 'MK FX',     color: TIBHAR_COLOR, shape: 'circle', url: '' },
        { x: 124, y: 130, label: 'MK Pro',    color: TIBHAR_COLOR, shape: 'circle', url: '' },
    ];

    // --- 2. Chart Setup ---
    const ctx = document.getElementById('rubberChart').getContext('2d');

    const butterflyDataset = {
        label: BUTTERFLY, // Single Category Name
        data: butterflyRubbers,
        // Map the styles from the data array
        pointBackgroundColor: butterflyRubbers.map(d => d.color),
        pointStyle: butterflyRubbers.map(d => d.shape),
        pointRadius: 7,
        pointHoverRadius: 9
    };

    const tibharDataset = {
        label: TIBHAR,
        data: tibharRubbers,
        pointBackgroundColor: tibharRubbers.map(d => d.color ?? TIBHAR_COLOR),
        pointStyle: tibharRubbers.map(d => d.shape ?? 'circle'),
        pointRadius: 7,
        pointHoverRadius: 9
    };

    const chart = new Chart(ctx, {
        type: 'scatter',
        data: {
            datasets: [
                butterflyDataset,
                tibharDataset
            ]
        },
        options: {
            responsive: true,
            maintainAspectRatio: false,
            layout: {
                padding: { top: 20, right: 50, bottom: 20, left: 20 }
            },
            scales: {
                x: {
                    min: 40,
                    max: 100,
                    title: {
                        display: true,
                        text: 'Spin',
                        font: { size: 16, weight: 'normal' },
                        color: '#000'
                    },
                    grid: {
                        color: 'white',
                        lineWidth: 2
                    }
                },
                y: {
                    min: 40,
                    max: 100,
                    title: {
                        display: true,
                        text: 'Speed',
                        font: { size: 16, weight: 'normal' },
                        color: '#000'
                    },
                    grid: {
                        color: 'white',
                        lineWidth: 2
                    }
                }
            },
            plugins: {
                legend: {
                    display: false
                },
                tooltip: {
                    enabled: true,
                    titleFont: { weight: 'normal' },
                    bodyFont: { weight: 'normal' },
                    callbacks: {
                        label: function(context) {
                            return `${context.raw.label} (Spin: ${context.raw.x}, Speed: ${context.raw.y})`;
                        }
                    }
                },
                datalabels: {
                    align: function(context) {
                        const val = context.dataset.data[context.dataIndex];
                        return val.x > 80 ? 'left' : 'right';
                    },
                    anchor: 'center',
                    offset: 10,
                    color: '#000',
                    font: { size: 11, weight: 'normal' },
                    formatter: function(value) {
                        return value.label;
                    }
                }
            },
            // --- 3. Click Event Handler ---
            onClick: (evt, activeElements, chart) => {
                if (activeElements.length > 0) {
                    const datasetIndex = activeElements[0].datasetIndex;
                    const dataIndex = activeElements[0].index;
                    const pointData = chart.data.datasets[datasetIndex].data[dataIndex];

                    // Prefer per-rubber manual link if provided.
                    const manualUrl = typeof pointData.url === 'string' ? pointData.url.trim() : '';
                    if (manualUrl) {
                        window.open(manualUrl, '_blank');
                        return;
                    }
                }
            }
        },
        plugins: [ChartDataLabels]
    });

    function setActiveBrand(brand) {
        // Ensure exactly one brand is visible.
        chart.setDatasetVisibility(0, brand === BUTTERFLY);
        chart.setDatasetVisibility(1, brand === TIBHAR);

        // Apply brand-specific axis ranges.
        const r = BRAND_AXIS_RANGES[brand];
        if (r) {
            chart.options.scales.x.min = r.xMin;
            chart.options.scales.x.max = r.xMax;
            chart.options.scales.y.min = r.yMin;
            chart.options.scales.y.max = r.yMax;
        }

        chart.update();

        // Update tab UI.
        const tabs = document.querySelectorAll('.tab[data-brand]');
        tabs.forEach((btn) => {
            const isActive = btn.getAttribute('data-brand') === brand;
            btn.classList.toggle('active', isActive);
            btn.setAttribute('aria-selected', isActive ? 'true' : 'false');
        });
    }

    // Default to Butterfly.
    setActiveBrand(BUTTERFLY);

    // Tab click handlers.
    document.querySelectorAll('.tab[data-brand]').forEach((btn) => {
        btn.addEventListener('click', () => {
            const brand = btn.getAttribute('data-brand');
            if (brand === BUTTERFLY || brand === TIBHAR) setActiveBrand(brand);
        });
    });

</script>

</body>
</html> 